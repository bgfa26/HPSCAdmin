/****** 
		PROCEDIMIENTO PARA AGREGAR EMPLEADOS A LA BASE DE DATOS (NO POSEEN NINGUN ROL) 
		FECHA: 20/06/2019 11:00 AM
******/
USE [MTGROUPDATABASE]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CREATE_EMPLOYEE]
  @id AS int,
  @workerid AS varchar (20),
  @firstname AS varchar (50),
  @lastname AS varchar (50),
  @email AS varchar (120),
  @password AS varchar (50)
AS
BEGIN
  IF ((SELECT COUNT(*) FROM EMPLOYEE WHERE ID = @id) = 0)
    IF ((SELECT COUNT(*) FROM EMPLOYEE WHERE WORKERID = @workerid) = 0)
      IF ((SELECT COUNT(*) FROM EMPLOYEE WHERE EMAIL = @email) = 0)
        BEGIN
          INSERT INTO EMPLOYEE VALUES(@id, @workerid, @firstname, @lastname, @email, @password, 1);
          RETURN 200;
        END;
      ELSE
        RETURN 103;
    ELSE
      RETURN 102;  
  ELSE
    RETURN 101;  
END

/****** 
    PROCEDIMIENTO PARA CONSULTAR EMPLEADOS MEDIANTE UN CORREO
    FECHA: 24/06/2019 12:39 PM
******/
USE [MTGROUPDATABASE]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CONSULT_EMPLOYEE_EMAIL]
  @email AS varchar(350)
AS
BEGIN
  SELECT E.ID, E.WORKERID, E.FIRSTNAME, E.LASTNAME, E.EMAIL, E.PASSWORD, E.STATUS, P.ID, P.NAME, OU.ID, OU.NAME
  FROM EMPLOYEE E, ASSIGNMENT A, POSITION P, ORGANIZATIONAL_UNIT OU 
  WHERE E.EMAIL = @email AND A.FK_EMPLOYEE = E.ID AND A.FK_POSITION = P.ID AND A.FK_ORGANIZATIONALUNIT = OU.ID;
END

/****** 
		PROCEDIMIENTO PARA CAMBIAR EL PWD DE UN EMPLEADO DE LA BASE DE DATOS POR CORREO
		FECHA: 25/06/2019 12:03 AM
******/
USE [MTGROUPDATABASE]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[CHANGE_PASSWORD]
  @email AS varchar(120),
  @password AS varchar(50),
  @exitvalue AS int OUTPUT
AS
BEGIN
  UPDATE [dbo].[EMPLOYEE] SET [PASSWORD] = @password WHERE [EMAIL] = @email
  set @exitvalue = 200;
  RETURN @exitvalue;
END

/****** 
		PROCEDIMIENTO PARA CONSULTAR TODOS LOS EMPLEADOS DE LA BASE DE DATOS
		FECHA: 25/06/2019 10:24 AM
******/
USE [MTGROUPDATABASE]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[GET_ALL_EMPLOYEES]
AS
BEGIN
	SELECT E.ID, E.FIRSTNAME, E.LASTNAME, E.EMAIL, E.E_PASSWORD, P.NAME, OU.NAME 
	FROM EMPLEADO E, ASSIGNMENT A, POSITION P, ORGANIZATIONAL_UNIT OU
	WHERE A.FK_EMPLOYEE = E.ID AND A.FK_POSITION = P.ID AND A.FK_ORGANIZATIONALUNIT = OU.ID;
END
